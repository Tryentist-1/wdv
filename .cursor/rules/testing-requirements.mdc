---
description: Testing requirements - test before deployment, mobile testing, edge cases
appliesTo: "*.js,*.php,*.html"
---

# Testing Requirements

## Single Source of Truth

**MANDATORY:** [docs/testing/TESTING_GUIDE.md](../../docs/testing/TESTING_GUIDE.md) is the canonical testing reference. When tests or scripts change, that document MUST be updated. Do not skip.

## Document Sync Rule (MANDATORY)

**When you add, move, or remove tests:**
1. Update `docs/testing/TESTING_GUIDE.md` â€” add/remove test files, fix commands.
2. Update `tests/TEST_ORGANIZATION.md` if structure changed.
3. Update `package.json` if adding/changing scripts.

**When you add or change test scripts:**
- Use path `./tests/scripts/<script>.sh` (never `./test_xyz.sh` at root).
- Document in TESTING_GUIDE.md.

---

## Testing Philosophy

**QA Lead Mindset:** All changes must be reviewed with testing in mind before production.

### Before Deployment

1. **Pre-deploy suite (MANDATORY):**
   ```bash
   npm run test:pre-deploy
   ```
   Runs: Production API health check (`./tests/scripts/test_api.sh`).

2. **Full local tests (when changing API/backend):**
   ```bash
   npm run serve               # Terminal 1: Start server (REQUIRED for API tests)
   npm run test:api:archers    # Terminal 2: API tests (or test:api:all)
   ```
   **Note:** API tests require a running server. Use `API_BASE_URL` env if your local API differs from `http://localhost:8001/api/index.php/v1`.

3. **Manual Smoke Test:**
   - Test on actual mobile device (iPhone SE minimum)
   - Test full workflow from setup to verification
   - Test offline/online sync behavior
   - Test dark mode and light mode

4. **Code Quality:**
   - No console errors on key pages
   - No lint errors
   - All changes committed to git

## Test Types

### Unit Tests
- Pure functions in `js/common.js` must have unit tests
- Located in `tests/` directory
- Use Jest or QUnit as appropriate

### Integration Tests (API)
- API endpoints tested via `tests/api/**/*.test.js` (Jest)
- Test harness (local): `http://localhost:8001/tests/api/harness/test_harness.html`
- Test full workflows, not just individual endpoints

### E2E Tests
- Playwright tests in `tests/*.spec.js`
- Test user workflows end-to-end
- Test mobile interactions

## Testing Checklist

Before marking feature complete:
- [ ] Pre-deploy suite passes: `npm run test:pre-deploy`
- [ ] API tests pass (if server running): `npm run test:api:archers`
- [ ] Tested on mobile device
- [ ] Tested in dark mode
- [ ] Tested offline behavior
- [ ] No console errors
- [ ] Edge cases handled (empty inputs, invalid data, etc.)
- [ ] Error states display properly

## Mobile Testing

**CRITICAL:** Always test on actual mobile device:
- iPhone SE (smallest screen)
- Touch interactions work
- Buttons are tappable
- Scrollable areas work correctly
- Modals display properly

## References

- **Canonical:** [docs/testing/TESTING_GUIDE.md](../../docs/testing/TESTING_GUIDE.md)
- **Test lifecycle:** [.agent/workflows/test-lifecycle.md](../../.agent/workflows/test-lifecycle.md)
- **Test structure:** [tests/TEST_ORGANIZATION.md](../../tests/TEST_ORGANIZATION.md)
- **Deployment:** [DEPLOYMENT_CHECKLIST.md](../../DEPLOYMENT_CHECKLIST.md)
